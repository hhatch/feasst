

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Files &mdash; FEASST v0.8.0-1-gead8d12ca1-dirty documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="https://pages.nist.gov/nist-header-footer/css/nist-combined.css" type="text/css" />
  <link rel="stylesheet" href="https://pages.nist.gov/leaveNotice/css/jquery.leaveNotice.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="&lt;no title&gt;" href="../doc/toc.html" />
    <link rel="prev" title="Flat histogram" href="../README.html" />

	<!-- frame blocking -->
	<script type="text/javascript">
		if (top !=self) {
			top.location=self.location;
		}
	</script>

	<!-- NIST header and footer -->
	<link rel="stylesheet" href="https://pages.nist.gov/nist-header-footer/css/nist-combined.css">



  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> FEASST
          

          
          </a>

          
            
            
              <div class="version">
                v0.8.0-1-gead8d12ca1-dirty
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../README.html">README</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/README.html">Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../README.html">Plugin</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../utils/README.html">Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../math/README.html">Math</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../configuration/README.html">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../system/README.html">System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../monte_carlo/README.html">Monte Carlo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../example/README.html">Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models/README.html">Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../steppers/README.html">Steppers</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../README.html">Flat histogram</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../README.html#tutorial">Tutorial</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">Files</a></li>
<li class="toctree-l4"><a class="reference internal" href="#grand-canonical-ensemble-transition-matrix-monte-carlo">Grand canonical ensemble transition-matrix Monte Carlo</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../README.html#feasst-plugin-dependencies">FEASST plugin dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../README.html#api">API</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../patch/README.html">Patch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../mayer/README.html">Mayer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../xtc/README.html">XTC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../chain/README.html">Chain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../confinement/README.html">Confinement</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ewald/README.html">Ewald</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../growth_expanded/README.html">Growth expanded</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pipeline/README.html">Pipeline</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../py/README.html">pyFEASST</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../forcefield/README.html">Forcefield</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../CONTACT.html">Contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../CONTRIBUTING.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ACKNOWLEDGEMENT.html">Acknowledgement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../CITATION.html">Citation guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">FEASST</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../README.html">Plugin</a> &raquo;</li>
        
          <li><a href="../README.html">Flat histogram</a> &raquo;</li>
        
      <li>Files</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="files">
<h1>Files<a class="headerlink" href="#files" title="Permalink to this headline">¶</a></h1>
<p>A series of files in <cite>plugin/flat_histogram/tutorial/</cite> include:</p>
<ul class="simple">
<li><cite>fh.py</cite> and <cite>lj_fh.py</cite>: utility modules to simplify creation of flat histogram criteria and Monte Carlo simulations.</li>
<li><cite>test_1_lj_gcmc.py</cite>: conduct grand canonical ensemble flat histogram Monte Carlo simulation of LJ and compare the free energy and potential energy with published results.</li>
</ul>
</div>
<div class="section" id="grand-canonical-ensemble-transition-matrix-monte-carlo">
<h1>Grand canonical ensemble transition-matrix Monte Carlo<a class="headerlink" href="#grand-canonical-ensemble-transition-matrix-monte-carlo" title="Permalink to this headline">¶</a></h1>
<div class="sidebar">
<p class="first sidebar-title">Testing tips</p>
<p class="last">A small macrostate range allows the simulation to run quickly with good sampling, and thus it is an ideal starting point to test the simulations.</p>
</div>
<p>In this example, flat histogram methods are employed for a small macrostate range from 0 to 5 particles.
Flat histogram acceptance criteria are defined using <cite>fh.py</cite>.
The Monte Carlo simulation is in <cite>lj_fh.py</cite>.
To begin, the system is initialized with the minimum number of particles by setting Metropolis acceptance criteria with favorable conditions for adding particles.
The Metropolis criteria are then replaced with the flat histogram criteria.
At this point, typical analysis from the previous tutorials are added.
In addition, we also add checkpoint files, criteria status, and average energy of a given macrostate.
Finally, the simulation is run until the requested number of iterations of the flat histogram algorithm are complete.</p>
<p>Run the simulation on the command line and you should see output like the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[user@host]$ feasst/py/run.sh feasst/plugin/flat_histogram/tutorial/test_1_lj_gcmc.py
...
.
----------------------------------------------------------------------
Ran 1 test in 70.702s

OK
</pre></div>
</div>
<p>A number of files should also have been created.
For example, a plot of the log file using <cite>python plot_log.py</cite> may look something like this:</p>
<div class="sidebar">
<p class="first sidebar-title">Sampling</p>
<p class="last">If the flat histogram method is sampling perfectly, the simulation performs a random walk along the macrostate.
For larger ranges of macrostates, or for more difficult sampling cases, monitoring the macrostate can help you determine what conditions are preventing covergence.</p>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../../../_images/log0.txt.svg"><img alt="../../../_images/log0.txt.svg" src="../../../_images/log0.txt.svg" width="50%" /></a>
</div>
<p>The energy of each macrostate may be visualized and compared with the published values in the NIST SRSW using <cite>python plot_energy.py</cite> which may look like this:</p>
<div class="sidebar">
<p class="first sidebar-title">Checkpointing</p>
<p class="last">Note that the <cite>plot_energy.py</cite> script makes use of the checkpoint file to obtain useful information such as the number of macrostates.</p>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../../../_images/energy.svg"><img alt="../../../_images/energy.svg" src="../../../_images/energy.svg" width="50%" /></a>
</div>
<p>You may also plot the natural logarithm of the macrostate probability using <cite>python plot_crit.py</cite> which may look like this:</p>
<div class="sidebar">
<p class="first sidebar-title">Histogram reweighting</p>
<p class="last">The macrostate probability distribution depends upon the choice of the chemical potential, but can be reweighted to different chemical potentials.</p>
</div>
<div class="figure">
<a class="reference internal image-reference" href="../../../_images/crit.svg"><img alt="../../../_images/crit.svg" src="../../../_images/crit.svg" width="50%" /></a>
</div>
<div class="section" id="ensemble-averages">
<h2>Ensemble averages<a class="headerlink" href="#ensemble-averages" title="Permalink to this headline">¶</a></h2>
<p>For a macrostate of the number of particles, <span class="math notranslate nohighlight">\(N\)</span>, the canonical ensemble averages from the flat histogram simulations are computed as follows:</p>
<div class="math notranslate nohighlight">
\[\langle A(N) \rangle_{NVT} = \frac{\sum_{i=0}^{N_{trial}} A(i) \delta(n_i - N)}{\sum_{i=0}^{N_{trial}} \delta(n_i - N)}\]</div>
<p>Instead of only utilizing the canonical ensemble averages at each value of the macrostate, one should instead compute a grand canonical ensemble average using the macrostate probability distribution and all of the canonical ensemble averages in the range <span class="math notranslate nohighlight">\(N \epsilon (N_{min}, N_{max})\)</span>.
In the example above, <span class="math notranslate nohighlight">\(N_{max}=5\)</span>.
Thus, grand canonical ensemble averages are defined as:</p>
<div class="math notranslate nohighlight">
\[\langle A(\langle N\rangle_{\mu VT}) \rangle_{\mu VT} = \sum_{n=N_{min}}^{N_{max}}\langle A(n) \rangle_{NVT}\Pi(n; \mu)\]</div>
<div class="sidebar">
<p class="first sidebar-title"><span class="math notranslate nohighlight">\(N_{min}\)</span> and <span class="math notranslate nohighlight">\(N_{max}\)</span></p>
<p class="last"><span class="math notranslate nohighlight">\(N_{min} = 0\)</span> is a natural choice if feasible.
These bounds, especially <span class="math notranslate nohighlight">\(N_{max}\)</span>, should be chosen such that <span class="math notranslate nohighlight">\(\Pi\)</span> is vanishingly small and therefore the canonical ensemble average does not contribute to the grand canonical ensemble average.</p>
</div>
<p>Where</p>
<div class="math notranslate nohighlight">
\[\langle N\rangle_{\mu VT} = \sum_{n=N_{min}}^{N_{max}} n\Pi(n; \mu)\]</div>
<p>Now that the grand canonical ensemble averages are computed for the particular value of the chemical potential, <span class="math notranslate nohighlight">\(\mu\)</span>, the macrostate distribution can be reweighted to different chemical potentials, <span class="math notranslate nohighlight">\(\mu'\)</span>.
Thus, with a continuous variation in <span class="math notranslate nohighlight">\(\mu'\)</span> one can also obtain a continuous variation in the grand canonical ensemble averages, within the limits of <span class="math notranslate nohighlight">\(N_{min}, N_{max}\)</span>.</p>
</div>
<div class="section" id="histogram-reweighting">
<h2>Histogram reweighting<a class="headerlink" href="#histogram-reweighting" title="Permalink to this headline">¶</a></h2>
<p>Analysis of flat histogram simulations is greatly enhanced by the use of histogram reweighting, which allows you to obtain information continuously as a function of the macrostate’s thermodynamic conjugate.
Thus, for the grand canonical ensemble with the number of particles as the macrostate, <span class="math notranslate nohighlight">\(N\)</span>, we can reweight to various values of chemical potential, <span class="math notranslate nohighlight">\(\mu\)</span>.
For microcanonical partition function, <span class="math notranslate nohighlight">\(\Omega(N,V,U)\)</span>, canonical, <span class="math notranslate nohighlight">\(Q(N,V,T)\)</span> and grand canonical, <span class="math notranslate nohighlight">\(\Xi(\mu, V, T)\)</span>, the probability to observe a state, <span class="math notranslate nohighlight">\(\Pi\)</span> is given by</p>
<div class="math notranslate nohighlight">
\begin{gather*}
\ln\Pi'(N,U; \mu', V, \beta) + \beta U - \beta \mu N = \ln\Omega(N,U,V) - \ln\Xi(\mu,V,T) \\
\ln\Pi'(N; \mu', V, \beta) = \ln\Pi(N; \mu, V, \beta) + N\beta(\mu` - \mu) + Const \\
\end{gather*}</div><p>For histogram reweighting, apply the last equation above to the macrostate probability distribution, <span class="math notranslate nohighlight">\(ln\Pi\)</span>, and renormalize, <span class="math notranslate nohighlight">\(\sum \Pi = 1\)</span>.
When there are multiple peaks in <span class="math notranslate nohighlight">\(ln\Pi\)</span> that do not change greatly with system size, this often corresponds to different macroscopic phases.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Did this tutorial work as expected?
Did you find any inconsistencies or have any comments?
Please <a class="reference internal" href="../../../CONTACT.html"><span class="doc">Contact</span></a> us.
Any feedback is appreciated!</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../doc/toc.html" class="btn btn-neutral float-right" title="&lt;no title&gt;" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../README.html" class="btn btn-neutral" title="Flat histogram" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="https://pages.nist.gov/nist-header-footer/js/jquery-1.9.0.min.js"></script>
        <script type="text/javascript" src="https://pages.nist.gov/nist-header-footer/js/nist-header-footer.js"></script>
        <script type="text/javascript" src="https://pages.nist.gov/leaveNotice/js/jquery.leaveNotice-nist.min.js"></script>
        <script type="text/javascript" src="../../../_static/leave_notice.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>